{"version":3,"sources":["../../src/chart.js"],"names":[],"mappings":"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","file":"chart.js","sourcesContent":["import d3 from 'd3';\nimport kotoAssert from './assert.js';\nimport Layer from './layer.js';\n\n// d3 is required\nkotoAssert(d3, 'd3 js is required.');\n\n/**\n * Create a koto chart\n *\n * @constructor\n *\n * @param {d3.selection} selection The chart's \"base\" DOM node. This should\n *        contain any nodes that the chart generates.\n */\nclass Chart {\n  constructor(selection) {\n    this.base = selection; // Container for chart @type {d3.selection}.\n    this.hasDrawn = false; // Has this chart been drawn at lease once?\n\n    function baseExtend(dst, maps) {\n      var setDst = function (value, key) {\n          dst.set(key, value);\n      };\n      for (var i = 0, ii = maps.length; i < ii; ++i) {\n        var map = maps[i];\n        map.forEach(setDst);\n      }\n      return dst;\n    }\n\n    this.merge = {\n      configs: function(){\n        var merged = baseExtend(this.configs, arguments);\n        return merged;\n      }.bind(this),\n      accessors: function(){\n        var merged = baseExtend(this.accessors, arguments);\n        return merged;\n      }.bind(this)\n    };\n\n    // exposed properties\n    this.configs = new Map();\n    this.accessors = new Map();\n    this.promise = null;\n\n    // private\n    this._layers = new Map();\n    this._attached = new Map();\n    this._events = new Map();\n\n    // alias\n    this.c = this.config;\n    this.a = this.accessor;\n  }\n\n  /**\n   * A \"hook\" method that you may define to modify input data before it is used\n   * to draw the chart's layers and attachments. This method will be used by all\n   * sub-classes.\n   *\n   * Note: you will most likely never call this method directly, but rather\n   * include it as part of a chart definition, and then rely on d3.chart to\n   * invoke it when you draw the chart with {@link Chart#draw}.\n   *\n   * @param {Array} data Input data provided to @link Chart#draw}.\n   * @returns {mixed} Data to be used in drawing the chart's layers and\n   *                  attachments.\n   */\n  transform(data) { return data; }\n\n  /**\n   * A \"hook\" method that you may define to choose which mutation of the input\n   * data is sent to which of the attached charts (by name). This method will\n   * be used by all sub-classes. This only applies to charts that use the\n   * {@link Chart#attach} method.\n   *\n   * Note: you will most likely never call this method directly, but rather\n   * include it as part of a chart definition, and then rely on d3.chart to\n   * invoke it when you draw the chart with {@link Chart#draw}.\n   *\n   * @param {String} data Name of attached chart defined in {@link Chart#attach}.\n   * @param {Array} data Input data provided to {@link Chart#draw}.\n   * @returns {mixed} Data to be used in drawing the chart's layers and\n   *                  attachments.\n   */\n  demux(name, data) { return data; }\n\n  /**\n   * A \"hook\" method that will allow you to run some arbitrary code before\n   * {@link Chart#draw}. This will run everytime {@link Chart#draw} is called.\n   *\n   * Note: you will most likely never call this method directly, but rather\n   * include it as part of a chart definition, and then rely on d3.chart to\n   * invoke it when you draw the chart with {@link Chart#draw}.\n   *\n   * Note 2: a `postDraw` event is also fired when appropriate;\n   *\n   * @param  {[type]} data [description]\n   * @return {[type]}      [description]\n   */\n  preDraw() {}\n\n  /**\n   * A \"hook\" method that will allow you to run some arbitrary code after\n   * {@link Chart#draw}. This will run everytime {@link Chart#draw} is called.\n   *\n   * Note: you will most likely never call this method directly, but rather\n   * include it as part of a chart definition, and then rely on d3.chart to\n   * invoke it when you draw the chart with {@link Chart#draw}.\n   *\n   * @param  {[type]} data [description]\n   */\n  postDraw() {}\n\n  /**\n   * A \"hook\" method that will allow you to run some arbitrary code after\n   * {@link Chart#draw} is called AND after all transitions for all layers\n   * and attached charts have been completed. This will run everytime\n   * {@link Chart#draw} is called.\n   *\n   * Note: you will most likely never call this method directly, but rather\n   * include it as part of a chart definition, and then rely on d3.chart to\n   * invoke it when you draw the chart with {@link Chart#draw}.\n   *\n   * Note 2: a `postTransition` event is also fired when appropriate;\n   *\n   * @param  {[type]} data\n   */\n  postTransition() {}\n\n  /**\n   * Remove a layer from the chart.\n   *\n   * @param {String} name The name of the layer to remove.\n   * @returns {Layer} The layer removed by this operation.\n   */\n  unlayer(name) {\n    var layer = this.layer(name);\n\n    this._layers.delete(name);\n    delete layer._chart;\n\n    return layer;\n  }\n\n  /**\n   * Interact with the chart's {@link Layer|layers}.\n   *\n   * If only a `name` is provided, simply return the layer registered to that\n   * name (if any).\n   *\n   * If a `name` and `selection` are provided, treat the `selection` as a\n   * previously-created layer and attach it to the chart with the specified\n   * `name`.\n   *\n   * If all three arguments are specified, initialize a new {@link Layer} using\n   * the specified `selection` as a base passing along the specified `options`.\n   *\n   * The {@link Layer.draw} method of attached layers will be invoked\n   * whenever this chart's {@link Chart#draw} is invoked and will receive the\n   * data (optionally modified by the chart's {@link Chart#transform} method.\n   *\n   * @param {String} name Name of the layer to attach or retrieve.\n   * @param {d3.selection|Layer} [selection] The layer's base or a\n   *        previously-created {@link Layer}.\n   * @param {Object} [options] Options to be forwarded to {@link Layer|the Layer\n   *        constructor}\n   *\n   * @returns {Layer}\n   */\n  layer(name, selection, options) {\n    var _Chart = this;\n    var _layer;\n\n    if (arguments.length === 1) {\n      return this._layers.get(name);\n    }\n\n    // we are reattaching a previous layer, which the\n    // selection argument is now set to.\n    if (arguments.length === 2) {\n\n      if (selection instanceof Layer) {\n        selection._chart = this;\n        this._layers.set(name, selection);\n        return this._layers.get(name);\n\n      } else {\n        kotoAssert(false, 'When reattaching a layer, the second argument must be a koto layer');\n      }\n    }\n\n    selection._chart = this;\n\n    _layer = new Layer(selection, options);\n\n    _layer.remove = function () {\n      _Chart._layers.delete(name);\n      return this;\n    };\n\n    this._layers.set(name, _layer);\n\n    return _layer;\n  }\n\n  /**\n   * Register or retrieve an \"attachment\" Chart. The \"attachment\" chart's `draw`\n   * method will be invoked whenever the containing chart's `draw` method is\n   * invoked.\n   *\n   * @param {String} attachmentName Name of the attachment\n   * @param {Chart} [chart] koto to register as a mix in of this chart. When\n   *        unspecified, this method will return the attachment previously\n   *        registered with the specified `attachmentName` (if any).\n   *\n   * @returns {Chart} Reference to this chart (chainable).\n   */\n  attach(attachmentName, chart) {\n    if (arguments.length === 1) {\n      return this._attached.get(attachmentName);\n    }\n\n    this._attached.set(attachmentName, chart);\n    return chart;\n  }\n\n  /**\n   * Update the chart's representation in the DOM, drawing all of its layers and\n   * any \"attachment\" charts (as attached via {@link Chart#attach}).\n   *\n   * Note: The first time you call this method, the property `hasDrawn` will be\n   * set to true. This is helpful if you want to only run some code on the first\n   * time the chart is drawn.\n   *\n   * @param {Object} data Data to pass to the {@link Layer#draw|draw method} of\n   *        this cart's {@link Layer|layers} (if any) and the {@link\n   *        Chart#draw|draw method} of this chart's attachments (if any).\n   */\n  draw(rawData) {\n    var layer, attachmentData, promises = [];\n\n    var data = this.transform(rawData);\n\n    this.preDraw(data);\n    this.trigger('preDraw', data);\n\n    for (layer of this._layers.values()) {\n      layer.draw(data);\n      promises.push(layer.promise);\n    }\n\n    for (var [attachmentName, attachment] of this._attached.entries()) {\n      attachmentData = this.demux ? this.demux(attachmentName, data) : data;\n      attachment.draw(attachmentData);\n      promises.push(attachment.promise);\n    }\n\n    this.hasDrawn = true;\n\n    this.promise = Promise.all(promises);\n\n    this.postDraw();\n    this.trigger('postDraw', data);\n\n    this.promise.then(function () {\n      this.postTransition(data);\n      this.trigger('postTransition', data);\n    }.bind(this));\n  }\n\n  /**\n   * Function invoked with the context specified when the handler was bound (via\n   * {@link Chart#on} {@link Chart#once}).\n   *\n   * @callback ChartEventHandler\n   * @param {...*} arguments Invoked with the arguments passed to {@link\n   *         Chart#trigger}\n   */\n\n  /**\n   * Subscribe a callback function to an event triggered on the chart. See {@link\n   * Chart#once} to subscribe a callback function to an event for one occurence.\n   *\n   * @externalExample {runnable} chart-on\n   *\n   * @param {String} name Name of the event\n   * @param {ChartEventHandler} callback Function to be invoked when the event\n   *        occurs\n   * @param {Object} [context] Value to set as `this` when invoking the\n   *        `callback`. Defaults to the chart instance.\n   *\n   * @returns {Chart} A reference to this chart (chainable).\n   */\n  on(name, callback, context) {\n    var events;\n    if (this._events.has(name)) {\n      events = this._events.get(name);\n    } else {\n      events = new Set();\n    }\n\n    events.add({\n      callback: callback,\n      context: context || this,\n      _chart: this\n    });\n\n    this._events.set(name, events);\n    return this;\n  }\n\n  /**\n   * Subscribe a callback function to an event triggered on the chart. This\n   * function will be invoked at the next occurance of the event and immediately\n   * unsubscribed. See {@link Chart#on} to subscribe a callback function to an\n   * event indefinitely.\n   *\n   * @externalExample {runnable} chart-once\n   *\n   * @param {String} name Name of the event\n   * @param {ChartEventHandler} callback Function to be invoked when the event\n   *        occurs\n   * @param {Object} [context] Value to set as `this` when invoking the\n   *        `callback`. Defaults to the chart instance\n   *\n   * @returns {Chart} A reference to this chart (chainable)\n   */\n  once(name, callback, context) {\n    var self = this;\n    var _once = function() {\n      self.off(name, _once);\n      callback.apply(this, arguments);\n    };\n    return this.on(name, _once, context);\n  }\n\n  /**\n   * Unsubscribe one or more callback functions from an event triggered on the\n   * chart. When no arguments are specified, *all* handlers will be unsubscribed.\n   * When only a `name` is specified, all handlers subscribed to that event will\n   * be unsubscribed. When a `name` and `callback` are specified, only that\n   * function will be unsubscribed from that event. When a `name` and `context`\n   * are specified (but `callback` is omitted), all events bound to the given\n   * event with the given context will be unsubscribed.\n   *\n   * @externalExample {runnable} chart-off\n   *\n   * @param {String} [name] Name of the event to be unsubscribed\n   * @param {ChartEventHandler} [callback] Function to be unsubscribed\n   * @param {Object} [context] Contexts to be unsubscribe\n   *\n   * @returns {Chart} A reference to this chart (chainable).\n   */\n  off(name, callback, context) {\n\n    // remove all events\n    if (arguments.length === 0) {\n      this._events.clear();\n      return this;\n    }\n\n    // remove all events for a specific name\n    if (arguments.length === 1) {\n      if (this._events.has(name)) {\n        this._events.get(name).clear();\n      }\n      return this;\n    }\n\n    // remove all events that match whatever combination of name, context\n    // and callback.\n\n    this._events.get(name).forEach((event, clone, map) => {\n      if ((callback && callback === clone.callback) ||\n          (context && context === clone.context)) {\n        map.delete(event);\n      }\n    });\n\n    return this;\n  }\n\n  /**\n   * Publish an event on this chart with the given `name`.\n   *\n   * @externalExample {runnable} chart-trigger\n   *\n   * @param {String} name Name of the event to publish\n   * @param {...*} arguments Values with which to invoke the registered\n   *        callbacks.\n   *\n   * @returns {Chart} A reference to this chart (chainable).\n   */\n  trigger(name, ...args) {\n    if (this._events.has(name)) {\n      this._events.get(name).forEach((event) => {\n        event.callback.call(event.context, ...args);\n      });\n    }\n    return this;\n  }\n  /**\n   * Get and set chart options (or configs)\n   *\n   * @param  {mixed} nameOrObject name of item getting or setting\n   *                              or its an object with key value pairs.\n   * @param  {mixed} value the value for config item witha that name.\n   * @return {mixed} if getting, its the value. if setting it is the chart instance.\n   */\n  config(nameOrObject, value) {\n    var key;\n    var definition;\n    var _Chart = this;\n\n    function setPercentage () {\n      function calcultePerecentage (arr, initialValue) {\n        var min = Math.min.call(null, arr.map(function (name) { return _Chart.config(name); }));\n        return initialValue / min;\n      }\n\n      if (definition.constrain === true) {\n        definition.percentage = calcultePerecentage(['width', 'height'], definition.value);\n      } else if (Array.isArray(definition.constrain)) {\n        definition.percentage = calcultePerecentage(definition.constrain, definition.value);\n      } else {\n        definition.percentage = calcultePerecentage([definition.constrain], definition.value);\n      }\n    }\n\n    if (arguments.length === 0) {\n      return this.configs;\n    }\n\n    if (arguments.length === 1) {\n      if (typeof nameOrObject === 'object') {\n        for (key in nameOrObject) {\n          if(this.configs.has(key)) {\n            definition = this.configs.get(key);\n            if (definition.hasOwnProperty('setter')) {\n              definition.value = definition.setter.call(definition, nameOrObject[key]);\n            } else {\n              definition.value = nameOrObject[key];\n            }\n            if (definition.hasOwnProperty('constrain')) {\n              setPercentage();\n            }\n            this.configs.set(key, definition);\n          } else {\n            console.warn(`config with name ${nameOrObject} is not defined.`);\n          }\n        }\n        return this;\n      }\n\n      kotoAssert(this.configs.has(nameOrObject), `${nameOrObject} is not a valid option.`);\n      definition = this.configs.get(nameOrObject);\n      if (definition.hasOwnProperty('getter')) {\n        return definition.getter.call(definition);\n      }\n      return definition.value;\n    }\n\n    if(arguments.length === 2) {\n      if (this.configs.has(nameOrObject)) {\n        definition = this.configs.get(nameOrObject);\n        if (definition.hasOwnProperty('setter')) {\n          definition.value = definition.setter.call(definition, value);\n        } else {\n          definition.value = value;\n        }\n        if (definition.hasOwnProperty('constrain')) {\n          setPercentage();\n        }\n        this.configs.set(nameOrObject, definition);\n      } else {\n        console.warn(`config with name ${nameOrObject} is not defined.`);\n      }\n      return this;\n    }\n  }\n\n  /**\n   * This will get or set any of the chart's accessors.\n   *\n   * @param  {String or Object} item If string, it will return the function for that accessor item.\n   *                                 If object, it will update that accessor with set function.\n   * @param  {function} [value] The function to update accessor item with.\n   * @return {object} The chart to preserve chainability.\n   */\n  accessor (item, value) {\n    var key;\n    if (arguments.length === 0) {\n      return this.accessors;\n    }\n\n    if (arguments.length === 1) {\n      if (typeof item === 'string') {\n        kotoAssert(this.accessors.has(item), `${item} is not a valid accessor.`);\n        return this.accessors.get(item);\n      } else {\n        for (key in item) {\n          this.accessors.set(key, item[key]);\n        }\n      }\n    } else {\n      this.accessors.set(item, value);\n    }\n    return this;\n  }\n\n  /**\n   * This will extend a chart by passing in an object of initialize function.\n   * @param  {Object || function} init Initialize function of object with initialize method.\n   * @return {Construtor}      Chart constructor\n   */\n  static extend(init) {\n    class chart extends this {\n      constructor(selection) {\n        var key;\n        super(selection);\n\n        if (typeof init === 'function') {\n          init.call(this);\n        } else {\n          for (key in init) {\n            this[key] = init[key];\n          }\n          this.initialize.call(this);\n        }\n\n      }\n    }\n    return chart;\n  }\n}\n\nexport default Chart;\n"]}